<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.5" />
<title></title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
</div>
<div class="tableblock">
<table rules="rows"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="left" valign="top"> Hostname </th>
<th align="left" valign="top"> OS </th>
<th align="left" valign="top"> Memory </th>
<th align="left" valign="top"> Disk </th>
<th align="left" valign="top"> Kickstart </th>
<th align="left" valign="top"> Manifest</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">nagios.cal.local</p></td>
<td align="left" valign="top"><p class="table">CentOS 6.3</p></td>
<td align="left" valign="top"><p class="table">256M</p></td>
<td align="left" valign="top"><p class="table">10G</p></td>
<td align="left" valign="top"><p class="table"><a href="https://github.com/ctrlaltlinux/tutorials/system_monitoring/nagios.ks">nagios.ks</a></p></td>
<td align="left" valign="top"><p class="table"><a href="https://github.com/ctrlaltlinux/tutorials/system_monitoring/nagios.pp">nagios.pp</a></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">client.cal.local</p></td>
<td align="left" valign="top"><p class="table">CentOS 6.3</p></td>
<td align="left" valign="top"><p class="table">256M</p></td>
<td align="left" valign="top"><p class="table">10G</p></td>
<td align="left" valign="top"><p class="table"><a href="https://github.com/ctrlaltlinux/tutorials/system_monitoring/client.ks">client.ks</a></p></td>
<td align="left" valign="top"><p class="table"><a href="https://github.com/ctrlaltlinux/tutorials/system_monitoring/client.pp">client.pp</a></p></td>
</tr>
</tbody>
</table>
</div>
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Computers are prone to failure. Given a long enough timeline, sooner or later something is going to fail within your network, the question isâ€¦ will you know when it does? Nagios is a system that runs pre-defined checks on your servers and network devices and will send a notification when a test fails. This can, in many cases, alert you about a problem before your users even become aware of it.</p></div>
<div class="paragraph"><p>Some examples of the types of things that you may like to check on your hosts could be:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Is the server responding to ping?
</p>
</li>
<li>
<p>
What is the load average on the server?
</p>
</li>
<li>
<p>
When were updates last applied to the server?
</p>
</li>
<li>
<p>
Does the server have adequate free disk space?
</p>
</li>
</ol></div>
<div class="paragraph"><p>In this tutorial you will learn how to install Nagios and to configure it to actively monitor a Linux server. You&#8217;ll also learn how to write your own custom Nagios checks and, finally, we&#8217;ll finish off by installing pnp4nagios which will take the performance data returned by Nagios checks to create graphs.</p></div>
</div>
<h2 id="_network_topology">Network topology</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Network map
</p>
</li>
<li>
<p>
Port used (with SSL)
</p>
</li>
<li>
<p>
Explain active vs passive checks (nrpe vs nrdp)
</p>
</li>
</ol></div>
<div class="paragraph"><p>In this tutorial we will be working off the above diagram. As you can see, two servers will be used. On nagios.cal.local we will be installing the Nagios monitoring software. This comes in the form of a web interface which will be run by Apache. The second server, client.cal.local, will be used as an example of how to configure a Linux host though Nagios can also be used to monitor Windows hosts ans other network devices.</p></div>
</div>
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Nagios is not provided as part of the standard CentOS software, so our first step is to install the EPEL (Extended Packages For Linux) repository. Once installed we can then install Apache, Nagios and the Nagios plugins package.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>yum install http://mirror.optus.net/epel/6/i386/epel-release-6-7.noarch.rpm
yum install httpd nagios nagios-plugins-all</tt></pre>
</div></div>
<div class="paragraph"><p>Don&#8217;t forget to set the services to start at boot. Also, Nagios creates it&#8217;s own vhost file as part of its installation. So, go ahead and start both Apache and Nagios now so we can log in and view the Nagios UI.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>chkconfig nagios on
chkconfig httpd on
service nagios start
service httpd start</tt></pre>
</div></div>
<div class="paragraph"><p>Before being able to connect from an external host, we&#8217;ll need to allow inbound connections on port 80 in the local firewall. In a production environment, you would want to use https rather than unencypted http. Go ahead and add a firewall rule using the following. Don&#8217;t forget to save the rule once added!</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>iptables -I INPUT 4 -p tcp --dport 80 -j ACCEPT
service iptables save</tt></pre>
</div></div>
</div>
<h2 id="_basic_tour">Basic Tour</h2>
<div class="sectionbody">
<div class="paragraph"><p>Now that our server is configured, you can log in to Nagios by browsing to http://ip address&gt;/nagios. You will be prompted for a user name and password, these will be set to the the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>Username:</strong> nagiosadmin
</p>
</li>
<li>
<p>
<strong>Password:</strong> nagiosadmin
</p>
</li>
</ul></div>
<div class="paragraph"><p>Have a look around once logged in. You will find the default host, called localhost. This is, of course, your Nagios server.</p></div>
</div>
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p>While monitoring the Nagios server itself is a good start, you&#8217;re probably going to quickly want to add more servers to your Nagios installation. To do this, start by changing to the <em>/etc/nagios</em> directory and creating a new subdirectory called <em>hosts</em>.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>cd /etc/nagios
mkdir hosts</tt></pre>
</div></div>
<div class="paragraph"><p>Create a new file in the hosts directory called <em>client.cal.local.cfg</em> and copy and paste the following configuration:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>define host{
        use                     linux-server
        host_name               client.cal.local
        alias                   client.cal.local
        address                 127.0.0.1
        }

define service{
        use                             local-service,srv-pnp
        host_name                       client.cal.local
        service_description             PING
        check_command                   check_ping!100.0,20%!500.0,60%
        }

define service{
        use                             local-service,srv-pnp
        host_name                       client.cal.local
        service_description             SSH
        check_command                   check_ssh
        notifications_enabled           1
        }</tt></pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Where files are located
</p>
</li>
<li>
<p>
Add a host
</p>
</li>
<li>
<p>
Add checks (active and passive)
</p>
</li>
</ol></div>
</div>
<h2 id="_adding_a_server">Adding a server</h2>
<div class="sectionbody">
<h3 id="_configuring_the_client">Configuring the client</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>yum install nrpe
chkconfig nrpe on
service nrpe start</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt>iptables -I INPUT 4 -p tcp --dport 5666 -j ACCEPT
service iptables save</tt></pre>
</div></div>
<h3 id="_configuring_the_server">Configuring the server</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>cd /etc/nagios
mkdir hosts
emacs hosts/test.cal.local</tt></pre>
</div></div>
<div class="paragraph"><p>copy details from /etc/nagios/objects/localhost.cfg (use find-and-replace)
emacs /etc/nagios/nagios.cfg (add the hosts directory - cfg_dir)</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service nagios reload</tt></pre>
</div></div>
</div>
<h2 id="_writing_checks">Writing checks</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Explain how it works
</p>
</li>
<li>
<p>
Make mention of nagios exchange
</p>
</li>
<li>
<p>
Create check for uptime
</p>
</li>
</ol></div>
</div>
<h2 id="_installing_pnp_4_nagios">Installing PNP 4 Nagios</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>yum install pnp4nagios</tt></pre>
</div></div>
<div class="paragraph"><p>edit /etc/nagios/nagios.cfg (enable performance data and copy and paste from pnp4nagios example config)</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>service nagios reload
service httpd reload</tt></pre>
</div></div>
<h3 id="_adding_popups">Adding popups</h3><div style="clear:left"></div>
<div class="paragraph"><p>cp /usr/share/doc/pnp4nagios-0.6.16/contrib/ssi/status-header.ssi /usr/share/nagios/html/ssi/
edit /etc/nagios/objects/commands (add extra string to action_url)</p></div>
</div>
<h2 id="_final_notes">Final notes</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Configure email alerts
</p>
</li>
<li>
<p>
Install the Nagios chrome plugin
</p>
</li>
</ol></div>
</div>
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<a href="http://shah-oss.blogspot.com.au/2011/06/pnp4nagios-with-centos.html">http://shah-oss.blogspot.com.au/2011/06/pnp4nagios-with-centos.html</a>
</p>
</li>
<li>
<p>
<a href="http://nnfailagutan.wordpress.com/2012/01/28/how-to-install-pnp4nagios-in-bulk-mode-for-centosrhelfedora/">http://nnfailagutan.wordpress.com/2012/01/28/how-to-install-pnp4nagios-in-bulk-mode-for-centosrhelfedora/</a>
</p>
</li>
</ol></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2012-12-11 21:07:18 EST
</div>
</div>
</body>
</html>
